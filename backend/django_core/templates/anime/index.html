{% load static %}

<home-container
    class="mt-16 block md:mt-0 md:p-[1.25vw] md:pr-[3.75vw]"
    _="init call window.timer.start() end"
>
    <hero-section class="flex flex-col justify-between md:flex-row">
        <latest-animes-slider class="relative h-96 w-full md:h-[26vw] md:w-[42vw]">
            <slider
                class="h-full duration-300 flex md:rounded-t-[0.875vw]"
                _="
                   on fetch:beforeRequest(headers)
                   add .bg-neutral to me
                   add .backdrop-blur-sm to next <backdrop/>
                   then call window.timer.reset()

                   on fetch:afterResponse
                   wait 300ms
                   remove .bg-neutral from me
                   send hyperscript:change_active(index:current_index) to .slider-brick
                   then remove .backdrop-blur-sm from next <backdrop/>

                   on hyperscript:slide_next
                   fetch `{{ request.get_full_path }}_slider/${next_index}`
                   put result into my innerHTML
                   call _hyperscript.processNode(my)
                   end

                   on hyperscript:slide_prev
                   fetch `{{ request.get_full_path }}_slider/${previous_index}`
                   put result into my innerHTML
                   call _hyperscript.processNode(my)
                   end

                   on hyperscript:slide_to(index)
                   fetch `{{ request.get_full_path }}_slider/${index}`
                   put result into my innerHTML
                   call _hyperscript.processNode(my)
                   end

                   init
                   set global touch_start_x to 0
                   set global touch_end_x to 0
                   get global current_index
                   if not current_index
                   set global current_index to 0
                   end
                   fetch `{{ request.get_full_path }}_slider/${current_index}`
                   put result into my innerHTML
                   call _hyperscript.processNode(my)
                   end

                   on mouseenter call window.timer.pause() end
                   on mouseleave call window.timer.start() end

                   on touchstart set global touch_start_x to event.changedTouches[0].screenX end
                   on touchend
                   set global touch_end_x to event.changedTouches[0].screenX
                   send hyperscript:check_direction to me
                   end

                   on hyperscript:check_direction
                   if touch_end_x < touch_start_x
                   send hyperscript:slide_prev to me
                   else send hyperscript:slide_next to me
                   end
                  "
            ></slider>
            <backdrop class="absolute inset-0 bg-transparent duration-300 md:rounded-t-[0.875vw] pointer-events-none"></backdrop>
            <slide-progress class="flex w-full flex-col">
                <progress-bar
                    class="h-[0.2rem] md:h-[0.145vw] bg-warning duration-300 ease-linear"
                    _="
                       on hyperscript:timer_updated(value)
                       set my *width to value%
                      "
                ></progress-bar>
                <animes-boxes class="hidden w-full grid-cols-6 gap-[0.9375vw] md:mt-[1.25vw] md:grid">
                    {% for _ in latest_animes %}
                        <button
                            class="slider-brick col-span-1 h-[0.625vw] w-full rounded-[0.1875vw] border-[0.15vw] border-secondary-300 transition duration-300 hover:border-surface-50/50"
                            _="
                               on click
                               send hyperscript:slide_to(index:{{ forloop.counter0 }}) to <slider/>
                               end

                               on hyperscript:change_active(index)
                               if {{ forloop.counter0 }} is equal to index
                               add .bg-warning to me
                               else remove .bg-warning from me
                               end
                              "
                        ></button>
                    {% endfor %}
                </animes-boxes>
            </slide-progress>
            <button
                class="btn btn-primary text-accent min-h-max p-0 absolute -left-[1vw] top-[12vw] z-20 hidden h-[2.25vw] w-[2.25vw] rounded-[0.375vw] md:flex"
                _="on click send hyperscript:slide_prev to <slider/>"
            >
                {% include "icons/chevron.html" with class="w-[1.25vw] rotate-90" %}
            </button>
            <button
                class="btn btn-primary text-accent min-h-max p-0 absolute -right-[1vw] top-[12vw] z-20 hidden h-[2.25vw] w-[2.25vw] rounded-[0.375vw] bg-secondary-800 md:flex"
                _="on click send hyperscript:slide_next to <slider/>"
            >
                {% include "icons/chevron.html" with class="w-[1.25vw] -rotate-90" %}
            </button>
        </latest-animes-slider>
        <latest-episodes class="hidden w-[21.5625vw] md:block">
            <section-header class="flex items-center justify-between pr-[0.75vw]">
                <header-title class="flex items-center gap-[0.625vw]">
                    <span class="text-[1.25vw] font-bold">Latest Episodes</span>
                    <button class="btn btn-secondary hidden rounded-[0.1875vw] p-0 md:flex md:h-[1.5vw] md:w-[1.5vw] min-h-full">
                        {% include "icons/settings.html" with class="w-[0.9vw] opacity-75" %}
                    </button>
                </header-title>
                <button class="btn btn-neutral rounded-[0.3vw] text-[0.9vw] font-semibold p-0 min-h-max md:h-[2vw] md:px-[0.5vw]">
                    <span>Full List</span>
                    {% include "icons/arrow_up_right.html" with class="w-[1vw]" %}
                </button>
            </section-header>
            {% component_block 'scroll_area' parent_class='mt-[1vw] max-h-[22.25vw] snap-y smooth-scroll md:pr-[1vw]' scroll_area_class='flex flex-col gap-[1vw]' %}
                {% for episode in latest_episodes %}
                    <anime-episode
                        role="group"
                        class="group relative h-[5vw] duration-300 ease-in-out hover:h-[16vw]"
                        _="
                           on mouseenter
                           wait 300ms
                           set global episode_expanded to true
                           send hyperscript:change_view to <more-anime-info/> in me
                           js(me)
                           const parent_element = me.parentElement;
                           const scroll_area_element = me.parentElement.parentElement;

                           // Declare rects
                           const parent_rect = parent_element.getBoundingClientRect();
                           const me_rect = me.getBoundingClientRect();

                           const scroll_area_center = scroll_area_element.offsetHeight / 2;
                           const me_center = me_rect.top - parent_rect.top + me_rect.height / 2;
                           const target_scroll_top = me_center - scroll_area_center + parseInt(getComputedStyle(parent_element).gap) || 0;

                           scroll_area_element.scroll({
                           top: target_scroll_top,
                           behavior: 'smooth'
                           });
                           end

                           on mouseleave
                           send hyperscript:change_view to <more-anime-info/> in me
                           end
                          "
                    >
                        <div class="absolute h-full w-full rounded-[0.75vw] object-cover object-center">
                            <img
                                class="absolute h-full w-full rounded-[0.75vw] object-cover object-center"
                                src="{{ episode.cover }}" alt="" style=""
                                loading="lazy"
                            />
                        </div>
                        <gradient-overlay class="gradient absolute inset-0 bg-gradient-to-t from-secondary/75 to-secondary/0"></gradient-overlay>
                        <gradient-overlay class="gradient absolute inset-0 bg-gradient-to-r from-secondary/50 to-secondary/0"></gradient-overlay>
                        <episode-info class="absolute inset-0 flex items-start justify-between p-[1.3125vw]">
                            <div class="flex flex-col gap-[0.25vw]">
                                <episode-name class="text-[1vw] font-semibold leading-[1.1875vw] text-white">SpyxFamily</episode-name>
                                <episode-dates class="flex items-center gap-[0.35vw] text-[0.8vw] text-accent">
                                    <span class="font-semibold">Ep 06</span>
                                    <span>aired 3 months ago</span>
                                </episode-dates>
                            </div>
                            <a href="/anime/mal/1/episode/6" class="btn btn-warning btn-square min-h-max rounded-full text-secondary p-0">
                                {% include "icons/play.html" with class="w-[1vw]" %}
                            </a>
                        </episode-info>

                        <more-anime-info
                            class="invisible absolute inset-x-0 bottom-0 flex flex-col gap-[0.5vw] p-[1.3125vw]"
                            _="
                               on hyperscript:change_view
                               if global episode_expanded is true and I match .invisible
                               remove .invisible from me
                               else add .invisible to me
                               end
                              "
                        >
                            <genres class="flex items-center md:my-[0.35vw] md:gap-[0.5vw]">
                                <genre class="bg-accent font-semibold leading-none text-secondary md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">
                                    Horror
                                </genre>
                                <genre class="bg-accent font-semibold leading-none text-secondary md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">
                                    Sci-Fi
                                </genre>
                                <genre class="bg-accent font-semibold leading-none text-secondary md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">
                                    Thriller
                                </genre>
                            </genres>
                            <scroll-area gradient_mask='true' parent_class='md:max-h-[6vw]' class='text-accent md:text-[0.8vw] md:leading-[1vw]'>
                                {{ episode.synopsis }}
                            </scroll-area>
                        </more-anime-info>
                    </anime-episode>
                {% endfor %}
            {% endcomponent_block %}
            <section-bottom class="mt-[0.75vw] flex items-start justify-between gap-[2vw] pr-[0.75vw]">
                <span class="text-[0.75vw] font-semibold md:leading-[1.25vw]">showing recently aired episodes from your Anime List</span>
                <button class="btn btn-secondary p-0 text-[0.75vw] font-semibold text-warning"> Change to All </button>
            </section-bottom>
        </latest-episodes>
        <navigation-card class="relative mt-[2.75vw] hidden h-[24.5vw] w-[16.625vw] md:block">
            <div class="absolute h-full w-full rounded-[0.875vw] object-cover object-center">
                <img
                    class="absolute h-full w-full rounded-[0.875vw] object-cover object-center"
                    src="https://i.pinimg.com/originals/b7/25/12/b725125aaebafbcbf2fb3886a55d2d6f.jpg"
                    alt=""
                    style=""
                    loading="lazy"
                />
            </div>
            <gradient class="absolute inset-0 bg-gradient-to-t from-secondary from-[1%] to-secondary/25"></gradient>
            <gradient class="absolute inset-0 bg-gradient-to-r from-secondary/50 to-secondary/25"></gradient>
            <navigation-content class="absolute inset-0 flex flex-col justify-between px-[1.875vw] pt-[2vw] text-accent">
                <section-header class="flex flex-col gap-[0.2w]">
                    <span class="text-[1.5vw] font-bold leading-[1vw]">Welcome</span>
                    <span class="text-[0.875vw] font-semibold leading-[2.5vw]">Jump quickly into</span>
                </section-header>
                <navigation-left-buttons class="mt-[1vw] flex flex-col gap-[0.75vw]">
                    <div class="flex items-center gap-[1vw]">
                        <button class="btn btn-warning min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] p-0">
                            {% include "icons/chat.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <span class="text-[1vw] font-bold">Forums</span>
                    </div>
                    <div class="flex items-center gap-[1vw]">
                        <button class="btn btn-warning min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] bg-surface-50 p-0">
                            {% include "icons/recent.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <span class="text-[1vw] font-bold">Last watched anime</span>
                    </div>
                    <div class="flex items-center gap-[1vw]">
                        <button class="btn btn-warning min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] bg-surface-50 p-0">
                            {% include "icons/notifications.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <span class="text-[1vw] font-bold">Notifications</span>
                    </div>
                </navigation-left-buttons>
                <navigation-right-buttons class="mt-[0.4vw]">
                    <span class="text-[0.9vw] font-semibold leading-none">More</span>
                    <div class="mt-[0.75vw] flex gap-[0.9375vw]">
                        <button class="btn btn-accent min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] p-0">
                            {% include "icons/language.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <button class="btn btn-accent min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] p-0">
                            {% include "icons/preferences.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <button class="btn btn-accent min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] p-0">
                            {% include "icons/moon.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                        <button class="btn btn-accent min-h-max h-[2.5vw] w-[2.5vw] rounded-[0.375vw] bg-surface-50 p-0">
                            {% include "icons/settings.html" with class="text-surface-900 w-[1.25vw]" %}
                        </button>
                    </div>
                </navigation-right-buttons>
                {% include "icons/coreproject_text.html" %}
            </navigation-content>
        </navigation-card>
    </hero-section>
    <my-list class="flex flex-col p-4 pt-7 md:mb-[1vw] md:mt-[2.1875vw] md:flex md:w-[68vw] md:p-0">
        <section-header class="flex items-center gap-[0.625vw]">
            <header-title class="text-lg font-bold md:text-[1.25vw]">My List</header-title>
            <button class="btn btn-secondary hidden rounded-[0.1875vw] p-0 md:flex md:h-[1.5vw] md:w-[1.5vw] min-h-full">
                {% include "icons/settings.html" with class="w-[0.9vw] opacity-75" %}
            </button>
        </section-header>
        <my-list-info class="flex items-center justify-between">
            <span class="text-sm text-surface-50 md:text-[1vw] md:font-semibold">7 anime in Watching</span>
            <my-list-options class="hidden items-center gap-[1vw] md:flex">
                <button class="btn btn-neutral min-h-max h-[2.25vw] w-[6.625vw] gap-[0.625vw] rounded-[0.375vw] bg-surface-400 p-0 text-[0.875vw] font-semibold">
                    Watching
                    {% include "icons/chevron.html" with class="w-[1vw]" %}
                </button>
                <button class="btn btn-neutral min-h-max h-[2.25vw] w-[5.625vw] gap-[0.625vw] rounded-[0.375vw] bg-surface-400 p-0 text-[0.875vw] font-semibold">
                    Full List
                    {% include "icons/arrow_up_right.html" with class="w-[1vw]" %}
                </button>
            </my-list-options>
            <see-all class="md:hidden">
                <button class="btn gap-2 p-0 text-sm">
                    See all
                    {% include "icons/chevron.html" with class="w-4 -rotate-90 text-primary-400" %}
                </button>
            </see-all>
        </my-list-info>
        <my-list-animes class="relative mt-4 grid grid-cols-3 gap-3 md:mt-[1vw] md:grid-cols-5 md:gap-[1.25vw]">
            {% for anime in my_list %}
                <div class="dropdown dropdown-hover">
                    <button
                        tabindex="0"
                        hx-target="<content/>"
                        hx-get="/anime/mal/1/episode/4"
                        class="relative"
                        aria-expanded="false"
                    >
                        <dropdown-content class="h-60 w-full rounded-lg object-cover object-center md:h-[20vw] md:rounded-[0.5vw]">
                            <img
                                class="h-60 w-full rounded-lg object-cover object-center md:h-[20vw] md:rounded-[0.5vw]"
                                src="{{ anime.image }}"
                                alt="One piece"
                                style=""
                                loading="lazy"
                            />
                        </dropdown-content>
                        <anime-info class="absolute inset-x-0 bottom-0 rounded-b-lg backdrop-blur md:rounded-b-[0.5vw]">
                            <div class="flex flex-col gap-1 bg-secondary/95 p-3 md:gap-[0.35vw] md:p-[1vw]">
                                <scroll-area gradient_mask='true' parent_class='flex self-start md:max-h-[1.35vw] md:leading-[1.35vw] hover:max-h-[10vw] duration-300' class='line-clamp-1 md:line-clamp-none text-sm font-semibold md:text-[1vw]' %}
                                             {{ anime.name }}
                                             </scroll-area>
                                    <anime_info class="flex items-center gap-2 text-xs leading-none text-surface-50 md:gap-[0.5vw] md:text-[0.8vw]">
                                        <span class="hidden md:flex capitalize">{{ anime.status }}</span>
                                        {% include "icons/dot.html" with class="hidden opacity-75 md:flex md:w-[0.25vw]" %}
                                        <span>{{ anime.current_ep }}/{{ anime.total_ep }} eps</span>
                                    </anime_info>
                                </div>
                            </anime-info>
                        </button>
                        <ul
                            tabindex="0"
                            class="dropdown-content z-10 top-0 hidden flex-col leading-none md:flex md:w-[20vw]"
                            _="
                               init
                               js(me)
                               me.style.left = getComputedStyle(me.parentElement).width
                               me.style.paddingLeft = getComputedStyle(me.parentElement.parentElement).gap
                               end
                              "
                        >
                            <div class="flex flex-col md:gap-[0.35vw] md:p-[1vw] md:rounded-[0.75vw] md:rounded-t-[0.3vw] bg-neutral">
                                <anime-name class="text-accent font-semibold md:text-[1vw] md:leading-[1.25vw]">
                                    {{ anime.name }}
                                </anime-name>
                                <div class="flex items-center text-surface-50 md:gap-[0.35vw] md:text-[0.8vw]">
                                    <rating class="flex items-center md:gap-[0.5vw]">
                                        <svg width="30" height="30" viewBox="0 0 30 30" fill="yellow" xmlns="http://www.w3.org/2000/svg" color="yellow" class="h-[1.1vw] w-[1.1vw]">
                                            <path d="M15 2.5L18.8625 10.325L27.5 11.5875L21.25 17.675L22.725 26.275L15 22.2125L7.275 26.275L8.75 17.675L2.5 11.5875L11.1375 10.325L15 2.5Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </svg>
                                        <span class="leading-none text-surface-50 md:text-[0.8vw]">
                                            4.5 rating
                                        </span>
                                    </rating>
                                    <svg class="opacity-50 md:w-[0.25vw]" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="5" cy="5" r="5" fill="currentColor"></circle>
                                    </svg>
                                    <anime-type>TV</anime-type>
                                    <svg class="opacity-50 md:w-[0.25vw]" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="5" cy="5" r="5" fill="currentColor"></circle>
                                    </svg>
                                    <episodes-count>{{ anime.total_ep }} episdoes</episodes-count>
                                </div>
                                <studio class="text-surface-50 md:text-[0.75vw]">
                                    <span>Bibury Animation Studios</span>
                                </studio>
                                <genres class="flex items-center md:my-[0.35vw] md:gap-[0.5vw]">
                                    <genre class="bg-warning font-semibold leading-none text-black md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">Action </genre>
                                    <genre class="bg-warning font-semibold leading-none text-black md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">Ecchi </genre>
                                    <genre class="bg-warning font-semibold leading-none text-black md:rounded-[0.25vw] md:px-[0.6vw] md:py-[0.3vw] md:text-[0.8vw]">sci-Fi </genre>
                                </genres>
                                <scroll-area  parent_class='md:max-h-[4vw]' class='text-surface-50 md:text-[0.8vw] md:leading-[1vw]' >
                                    Azur Lane, a combination of all the different Camps in the world, was once successful in repelling the underwater menace, the Siren. Now splintered, they must face a new threat in Red Axis, former allies who crave to wield this otherworldly Siren technology for their own nefarious desires! Who will be victorious in the never-ending war between these battleship girls!? Akagami no Shirayuki-hime depicts Shirayuki's journey toward a new life at the royal palace of Clarines, as well as Zen's endeavor to become a prince worthy of his title. As loyal friendships are forged and deadly enemies formed, Shirayuki and Zen slowly learn to support each other as they walk their own paths.
                                </scroll-area/>
                                <div class="divider md:before:h-[0.15vw] md:after:h-[0.15vw] md:m-0"></div>
                                <options class="flex items-center md:gap-[0.5vw]">
                                    <a href="/anime/mal/1/episode/4" class="btn btn-primary text-accent h-[2.75vw] flex-1 leading-none md:rounded-[0.5vw] min-h-full">
                                        {% include "icons/play.html" with class="md:w-[0.9vw]" %}
                                        <span class="font-semibold md:text-[0.9vw]">
                                            Continue Ep {{ anime.current_ep }}
                                        </span>
                                    </a>
                                    <a href="/anime/mal/1" class="btn btn-square h-[2.75vw] p-0 leading-none md:rounded-[0.5vw] min-h-full">
                                        {% include "icons/info.html" with class="md:w-[1.2vw]" %}
                                    </a>
                                </options>
                            </div>
                        </ul>
                    </div>
            {% endfor %}
        </my-list-animes>
    </my-list>
</home-container>

{% load static %}

<!DOCTYPE html>
<html lang="en" class="bg-black bg-opacity-75">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />

        <script src="{% static 'js/anime.min.js' %}"></script>
        <script src="{% static 'admin/js/vendor/jquery/jquery.min.js'%}"></script>
        <script defer src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
        <script defer src="{% static 'js/alpine.min.js' %}"></script>

        <script type="module">
            import flamethrower from "{% static 'js/flamethrower.js' %}";
            const router = flamethrower({
                prefetch: 'visible',
                log: Boolean("{{ debug|yesno:'true,false' }}"),
                pageTransitions: false,
            });
        </script>

        <script type="module">
            const CHOICES = [
                'https://images.unsplash.com/photo-1666688090267-4858c2075629',
                'https://images.unsplash.com/photo-1666756272254-724e9ed61321',
                'https://images.unsplash.com/photo-1666845266582-7885e3485303',
            ];

            const element = document.querySelector('.background____item');

            const changeBackground = () => {
                const NewChoice = CHOICES.filter(
                    (item) => item != last_known_image
                );
                const index = Math.floor(Math.random() * NewChoice.length);
                last_known_image = NewChoice[index];

                anime
                    .timeline({
                        targets: element,
                        duration: 400,
                        easing: 'easeInOutQuad',
                    })
                    .add({
                        opacity: 0,
                    })
                    .add({
                        begin: () => {
                            element.innerHTML = ``;
                        },
                        complete: () => {
                            element.innerHTML = `
                                <div
                                    class="vh-100 vw-100"
                                    style=" 
                                        filter: brightness(0.5);
                                        background-repeat: no-repeat;
                                        background-size: cover;
                                        background-image: url('${last_known_image}');
                                    "
                                />
                            `.trim();
                        },
                    })
                    .add({
                        opacity: 1,
                    });
            };

            var last_known_image = '';

            $(document).ready(() => {
                CHOICES.forEach((item) => {
                    var link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'image';
                    link.href = item;
                    document.head.appendChild(link);
                });

                changeBackground();

                setInterval(() => {
                    changeBackground();
                }, 5000);
            });
        </script>

        <script>
            const checkMode = () => {
                function handleWindowChange(e) {
                    // Check if the media query is true
                    return e.matches;
                }
                /*
                    Mapped from here
                    https://bulma.io/documentation/helpers/visibility-helpers/
                */

                const MOBILE = window.matchMedia('(max-width: 768px)');
                const TABLET = window.matchMedia(
                    '(min-width: 769px) and (max-width: 1023px)'
                );
                const DESKTOP = window.matchMedia(
                    '(min-width: 1024px) and (max-width: 1215px)'
                );
                const WIDESCREEN = window.matchMedia(
                    '(min-width: 1216px) and (max-width: 1407px)'
                );
                const FULLHD = window.matchMedia('(min-width: 1408px )');

                if (handleWindowChange(MOBILE)) {
                    return 'mobile';
                } else if (handleWindowChange(TABLET)) {
                    return 'tablet';
                } else if (handleWindowChange(DESKTOP)) {
                    return 'desktop';
                } else if (handleWindowChange(WIDESCREEN)) {
                    return 'widescreen';
                } else if (handleWindowChange(FULLHD)) {
                    return 'fullhd';
                } else {
                    return null;
                }
            };

            document.addEventListener('alpine:init', () => {
                // Change the store's value
                window.addEventListener('resize', () => {
                    Alpine.store('responsiveMode', checkMode());
                });
                // Init the store.
                Alpine.store('responsiveMode', checkMode());
            });
        </script>
        {% block head %}{% endblock head %}
    </head>
    <body class="bg-black bg-opacity-75" x-init="() => $store.responsiveMode">
        <div class="d-grid vh-100 vw-100" style="grid-area: 1 / 1 / 2 / 2">
            <div
                style="grid-area: 1 / 1 / 2 / 2"
                class="background____item"
            ></div>
            <div style="display: inline-grid; grid-area: 1 / 1 / 2 / 2">
                {% block body %}{% endblock body %}
            </div>
        </div>
    </body>
</html>

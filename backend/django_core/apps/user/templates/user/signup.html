{% extends 'user/base.html' %}
<!--prettier-ignore-->
{% load crispy_forms_tags %}

{% block body %}

{% comment %} Start working on https://www.figma.com/file/knyOkHUChnJpsAsmuILhOk/Core-Project-%5BLegacy%5D?node-id=0%3A1 {% endcomment %}

<div
    class="card align-self-center text-light bg-transparent bg-gradient"
    style="width: 25rem; padding: 1em"
    x-bind:class="$store.responsiveMode === 'mobile' ? 'me-0' : 'me-5'"
    x-bind:style="$store.responsiveMode === 'mobile' ? { 'justify-self' : 'center'} : { 'justify-self' : 'end'}"
>
    <div class="card-header d-flex justify-content-center">
        Create an Account
    </div>
    {% crispy form %}
    <button type="submit" class="btn btn-primary">Submit</button>
</div>

<script type="module">
    // setup before functions
    var typingTimer; //timer identifier
    var doneTypingInterval = 5000; //time in ms, 5 seconds for example
    var input = $('#id_username_discriminator');

    // on keyup, start the countdown
    input.on('keyup', function () {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(doneTyping, doneTypingInterval);
    });

    // on keydown, clear the countdown
    input.on('keydown', function () {
        clearTimeout(typingTimer);
    });

    // user is "finished typing," do something
    function doneTyping() {
        let usernameDiscriminator = input.val();
        let username = document.querySelector('#id_username').value;

        $.ajax({
            url: "{% url 'username_discriminator_endpoint' %}",
            type: 'POST',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                username: username,
                username_discriminator: Number(usernameDiscriminator),
            },
        });
    }
</script>
{% endblock body %}
